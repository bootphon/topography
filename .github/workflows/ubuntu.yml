name: Ubuntu
on: push

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: "☁️ checkout repository"
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

      - name: "🔧 setup Python"
        uses: actions/setup-python@v3
        with:
          python-version: 3.9.x

      - name: " install dependencies"
        run: pip install isort black flake8 pylint

      - name: "🛠️ run isort"
        run: isort . --check-only

      - name: "🛠️ run black"
        run: black --check .

      - name: "🛠️ run flake8"
        run: flake8

      - name: "🛠️ run pylint"
        run: pylint topography

  test:
    runs-on: ubuntu-latest
    steps:
      - name: "☁️ checkout repository"
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

      - name: "🔧 setup Python"
        uses: actions/setup-python@v3
        with:
          python-version: 3.9.x

      - name: "🐍 update conda environment"
        run: |
          $CONDA/bin/conda env update -n topography-ci -f environment.yml
          $CONDA/bin/conda activate topography-ci

      - name: "📦 install package"
        run: $CONDA/bin/pip install .

      - name: "💻 pytest"
        run: "$CONDA/bin/pytest"
