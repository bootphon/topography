name: Ubuntu
on: push

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: "â˜ï¸ checkout repository"
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

      - name: "ğŸ”§ setup Python"
        uses: actions/setup-python@v3
        with:
          python-version: 3.9.x

      - name: " install dependencies"
        run: pip install isort black flake8 pylint

      - name: "ğŸ› ï¸ run isort"
        run: isort . --check-only

      - name: "ğŸ› ï¸ run black"
        run: black --check .

      - name: "ğŸ› ï¸ run flake8"
        run: flake8

      - name: "ğŸ› ï¸ run pylint"
        run: pylint topography

  test:
    runs-on: ubuntu-latest
    steps:
      - name: "â˜ï¸ checkout repository"
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

      - name: "ğŸ”§ setup Python"
        uses: actions/setup-python@v3
        with:
          python-version: 3.9.x

      - name: "ğŸ update conda environment"
        run: |
          $CONDA/bin/conda env update -n topography-ci -f environment.yml
          $CONDA/bin/conda activate topography-ci

      - name: "ğŸ“¦ install package"
        run: $CONDA/bin/pip install .

      - name: "ğŸ’» pytest"
        run: "$CONDA/bin/pytest"
